package rules;

import com.example.SBNZ.model.training.InputDataTraining;
import com.example.SBNZ.model.training.Training;
import com.example.SBNZ.model.training.Exercise;
import com.example.SBNZ.model.training.Session;
import com.example.SBNZ.model.training.CurrentFact;

import com.example.SBNZ.enums.diet.Goal;
import com.example.SBNZ.enums.training.Difficulty;
import com.example.SBNZ.enums.training.ExerciseCategory;
import com.example.SBNZ.enums.training.Muscle;
import java.util.ArrayList;
import java.util.List;
import java.util.Random;

function int generateRandomIndex(int listSize) {
    Random random = new Random();
    return random.nextInt(listSize-1);
}

// first step
rule "When daysweek and resttime is generated, and list of trainings is empty, generate the first training"
	no-loop
	when
	    $inputData: InputDataTraining($trainings: training, training.size() == 0)
        $currentFact: CurrentFact($exerciseList: exerciseList, daysWeek >= 3, daysWeek <= 5,
                                  $restTime: restTime, $numberOfSessions: numberOfSessions, $goal: goal)
	then
	    System.out.println("FOURTH LAYER RULE: INITIAL CREATE TRAINING");
        $inputData.getTraining().add(new Training($restTime, $numberOfSessions, $goal));
        update($inputData);
	end

rule "When training with less than 5 sessions exists, create a new session"
    when
        $inputData: InputDataTraining($trainings: training, training.size() > 0, training.get(training.size() - 1).getSessionList().size() < 4,
                                      $lastTraining: training.get(training.size() - 1))
        $currentFact: CurrentFact($exerciseList: exerciseList, $goal: goal)

        accumulate(
                           Exercise($e: this,
                                    $muscleList: muscleList
                                    ) from $exerciseList and
                                    Number(intValue == 0) from accumulate(
                                        Muscle($m: this, $muscleList.contains(this)// this memberOf $muscleList
                                        ) from $lastTraining.getMuscles(),
                                        count(1)
                                    ),
                           $filteredExercises: collectList($e)
                )
    then
        System.out.println("FOURTH LAYER RULE: ADD SESSION WHILE NO OF SESSIONS < 5");
        $lastTraining.addSession($filteredExercises);
        update($inputData);
    end

rule "When last created training is full, create a new training"
    no-loop
    when
        $currentFact: CurrentFact($exerciseList: exerciseList, $goal: goal, $restTime: restTime,
                                  $numberOfSessions: numberOfSessions, $daysWeek: daysWeek)
        $inputData: InputDataTraining($trainings: training, training.size() > 0, training.get(training.size() - 1).getSessionList().size() == 4,
                                              training.size() < $daysWeek)

    then
        System.out.println("FOURTH LAYER RULE: LAST TRAINING FULL AND SIZE < DAYSWEEK -> GENERATE NEW TRAINING");
        $inputData.getTraining().add(new Training($restTime, $numberOfSessions, $goal));
                update($inputData);
    end

// last step
rule "When number of trainings is equal to daysOfWeek -> the end"
    no-loop
    when
        $currentFact: CurrentFact($daysWeek: daysWeek)
        $inputData: InputDataTraining($trainings: training, training.size() > 0, training.size() == $daysWeek)
    then
        System.out.println("FINISHED GENERATING TRAININGS.");
        drools.halt();
    end

/*
rule "Lesgo"
	no-loop
	when
		$inputData: InputDataTraining(training.size() == 0)
        $currentFact: CurrentFact(layer == 5, $exerciseList: exerciseList, daysWeek >= 3, daysWeek <= 5 )
	then
        $inputData.getTraining().add(new Training());
        Session session = new Session();
        System.out.println($currentFact.getDaysWeek());
        session.setExercise((Exercise) $exerciseList.get(0));
        $inputData.getTraining().get($inputData.getTraining().size()-1).addSession(session);
        update($inputData);
	end

rule "End condition"
	no-loop
	when
	    $currentFact: CurrentFact(layer == 5, $daysOfWeek: daysWeek)
		$inputData: InputDataTraining(training.size() == $daysOfWeek)
	then
		System.out.println("we're done");
        update($inputData);
	end

rule "Lesg2o"

	when
		$currentFact: CurrentFact(layer == 5, $exerciseList: exerciseList)
		$inputData: InputDataTraining(training.size() != 0, training.get(training.size()-1).getSessionList().size() < 4,
										$muscles: training.get(training.size()-1).getMuscles())

		$muscle: Muscle() from $muscles
		accumulate(Exercise($e: this,
								!muscleList.contains($muscle)
                                    ) from $exerciseList,
                           $filteredExercises: collectList($e)
                )
	then
		System.out.println($muscle);
		System.out.println($filteredExercises);
		Session session = new Session();
        session.setExercise((Exercise) $filteredExercises.get(0));
        $inputData.getTraining().get($inputData.getTraining().size()-1).addSession(session);
        update($inputData);
	end
*/
